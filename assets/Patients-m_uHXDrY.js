import{r as u,A as K,u as R,a as U,b as V,j as e,c as o,I as c,B as z,L as W,i as Y,Q as H,d as B,e as $}from"./index-pZH199Q6.js";import{M as X,d as G,s as h,a as Q,p as Z,A as J}from"./validators-sdZyOb8J.js";import{C as ee}from"./Card-UHU3zEgu.js";import{S as te}from"./Select-n2n9yC1h.js";const ae=({onClose:C})=>{const{darkMode:p}=u.useContext(K),{clients:y,addClient:_,removeClient:k}=R(i=>i),{addPatient:N}=U(i=>i),{addChart:E,charts:w}=V(i=>i),[m,A]=u.useState(""),[r,I]=u.useState({name:"",species:"",strain:"",coloration:"",birth_date:null,weight:1,drugs:"",allergies:""}),[s,M]=u.useState({first_name:"",last_name:"",phone_number:"",city:"",postcode:"",street:"",street_number:""}),[n,P]=u.useState([]),[S,L]=u.useState(),[t,d]=u.useState(null),[T,q]=u.useState(!1);u.useEffect(()=>{if(!y)return;const i=y.map(a=>({value:a.id,label:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)}));i.unshift({value:0,label:"Nowy klient"}),L(i),d({value:0,label:"Nowy klient"})},[y]);const v=async i=>{i.preventDefault(),q(!0),P([]);const a=[],x=G(r.birth_date).format("YYYY-MM-DD");if(h(m)?w&&w.length>0&&w.forEach(l=>{l.number.trim()===m.trim()&&a.push("chartNumberExists")}):a.push("chartNumber"),!h(r.name)&&a.push("name"),!h(r.species)&&a.push("species"),!h(r.strain)&&a.push("strain"),!h(r.coloration)&&a.push("coloration"),!Q(x)&&a.push("birth_date"),parseFloat(r.weight<0)&&a.push("weight"),t&&t.value===0&&(!h(s.first_name)&&a.push("first_name"),!h(s.last_name)&&a.push("last_name"),!h(s.city)&&a.push("city"),!h(s.postcode)&&a.push("postcode"),!h(s.street)&&a.push("street"),!h(s.street_number)&&a.push("street_number"),(!s.phone_number||!Z(s.phone_number))&&a.push("phone_number")),a.length>0){P(a),q(!1);return}let g=!0,D=!1,f;if(t&&t.value===0)try{const l=await Y.post("/clients",s);_(l.data),f=l.data.id}catch(l){console.error("AddPatient :: submitHandler",l),g=!1}else f=t.value;let F;if(g)try{const l={...r};l.birth_date=x,l.clientId=parseInt(f),l.weight=parseFloat(r.weight);const O=await Y.post("/patients",l);N(O.data),D=!0,F=O.data.id}catch(l){console.error("AddPatient :: submitHandler",l),D=!1}if(g&&D&&F&&f){try{const l=await Y.post("/charts",{number:m.trim(),patientId:F,clientId:f});E(l.data),H.success("Karta pacjenta została utworzona")}catch(l){console.error("AddPatient :: submitHandler",l),H.error("Karta pacjenta nie została utworzona. Spróbuj ponownie")}C()}else if(g&&!D&&t.value===0){H.error("Karta pacjenta nie została utworzona. Spróbuj ponownie");try{await Y.delete(`/clients/${f}`),k(f)}catch(l){console.error("AddPatient :: submitHandler",l)}}q(!1)},j=i=>{const{name:a,value:x}=i.target;I(g=>({...g,[a]:x}))},b=i=>{const{name:a,value:x}=i.target;M(g=>({...g,[a]:x}))};return e.jsx(X,{onClose:C,disableOverlayOnClose:!0,width:800,children:e.jsxs("div",{id:"add-client",children:[e.jsx("h2",{children:"Utwórz kartę pacjenta"}),e.jsxs("form",{onSubmit:v,children:[e.jsx("h3",{style:{color:p?o.yellow:o.purple},children:"Numer karty pacjenta"}),e.jsx("div",{className:"chart-number",children:e.jsx(c,{id:"chartNumber",value:m,onChange:i=>A(i.target.value),hasError:n.includes("chartNumberExists")||n.includes("chartNumber"),errorText:n.includes("chartNumberExists")?"Taki numer karty pacjenta już istnieje":"Pole wymagane"})}),e.jsx("h3",{style:{color:p?o.yellow:o.purple},children:"Pacjent"}),e.jsxs("div",{className:"patient",children:[e.jsx(c,{required:!0,id:"name",label:"Imię",value:r.name,onChange:j,hasError:n.includes("name"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"species",label:"Gatunek",value:r.species,onChange:j,hasError:n.includes("species"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"strain",label:"Rasa",value:r.strain,onChange:j,hasError:n.includes("strain"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"coloration",label:"Umaszczenie",value:r.coloration,onChange:j,hasError:n.includes("coloration"),errorText:"Pole wymagane"}),e.jsx(c,{type:"date",required:!0,label:"Data urodzenia",value:r.birth_date,onChange:i=>I(a=>({...a,birth_date:i})),hasError:n.includes("birth_date"),errorText:"Niepoprawna data"}),e.jsx(c,{required:!0,id:"weight",label:"Waga (kg)",type:"number",value:r.weight,onChange:j,hasError:n.includes("weight"),errorText:"Niepoprawna wartość",min:0,step:.5}),e.jsx(c,{type:"textarea",id:"drugs",label:"Leki",value:r.drugs,onChange:j}),e.jsx(c,{type:"textarea",id:"allergies",label:"Alergie",value:r.allergies,onChange:j})]}),e.jsx("h3",{style:{color:p?o.yellow:o.purple},children:"Klient"}),S&&e.jsx(te,{id:"selectedClient",value:t||null,options:S,onChange:i=>{const a=S.find(x=>x.value===parseInt(i.target.selectedOptions[0].value));d(a)}}),e.jsx("div",{className:"client",children:t&&t.value===0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{required:!0,id:"first_name",name:"first_name",label:"Imię",value:s.first_name,onChange:b,hasError:n.includes("first_name"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"last_name",name:"last_name",label:"Nazwisko",value:s.last_name,onChange:b,hasError:n.includes("last_name"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"phone_number",label:"Numer telefonu",value:s.phone_number,onChange:b,hasError:n.includes("phone_number"),errorText:"Wymagany format: +XXYYYYYYYYY"}),e.jsx(c,{required:!0,id:"city",label:"Miejscowość",value:s.city,onChange:b,hasError:n.includes("city"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"postcode",label:"Kod pocztowy",value:s.postcode,onChange:b,hasError:n.includes("postcode"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"street",label:"Ulica",value:s.street,onChange:b,hasError:n.includes("street"),errorText:"Pole wymagane"}),e.jsx(c,{required:!0,id:"street_number",label:"Numer domu",value:s.street_number,onChange:b,hasError:n.includes("street_number"),errorText:"Pole wymagane"})]})}),e.jsx("div",{className:"actions",children:T?e.jsx(W,{color:p?o.yellow:o.purple}):e.jsxs(e.Fragment,{children:[e.jsx(z,{text:"Anuluj",onClick:C}),e.jsx(z,{text:"Zatwierdź",type:"submit",onClick:v,textColor:o.white,bgColor:o.green})]})})]})]})})},le=()=>{const C=B(),{darkMode:p}=u.useContext(K),{user:y}=$(t=>t),{patients:_}=U(t=>t),{charts:k}=V(t=>t),{clients:N}=R(t=>t),[E,w]=u.useState(!1),[m,A]=u.useState(""),[r,I]=u.useState([]),[s,M]=u.useState(null),[n,P]=u.useState("active"),[S,L]=u.useState(!1);return u.useEffect(()=>{if(!k||!_||!N)return;const t=k.map(d=>{const T=_.find(v=>v.id===d.patientId)||null,q=N.find(v=>v.id===T.clientId)||null;return{...d,patient:T,client:q}});M(t)},[k,_,N]),u.useEffect(()=>{if(!s)return;w(!0);let t=[];m?t=s.filter(d=>d.number.toLowerCase().includes(m.toLowerCase())||d.patient.name.toLowerCase().includes(m.toLowerCase())||d.client.first_name.toLowerCase().includes(m.toLowerCase())||d.client.last_name.toLowerCase().includes(m.toLowerCase())):t=s,n==="active"?t=t.filter(d=>d.is_active):t=t.filter(d=>!d.is_active),I(t),w(!1)},[m,s,n]),e.jsxs(e.Fragment,{children:[S&&e.jsx(ae,{onClose:()=>L(!1)}),e.jsxs("div",{id:"patients",children:[e.jsxs("div",{className:"actions",children:[e.jsxs("div",{className:`filter ${p?"light":"dark"}`,children:[e.jsx(z,{text:"Aktywne",onClick:()=>P("active"),className:n==="active"?"active":null}),e.jsx(z,{text:"Nieaktywne",onClick:()=>P("inactive"),className:n==="inactive"?"active":null})]}),e.jsx(c,{placeholder:"Wyszukaj kartę pacjenta...",inputWidth:"30rem",value:m,onChange:t=>A(t.target.value)}),y.is_admin&&e.jsx(z,{text:"Utwórz kartę pacjenta",color:p?"light":"dark",icon:e.jsx(J,{}),bgColor:o.green,textColor:o.white,onClick:()=>L(!0)})]}),E&&e.jsx("div",{className:"centered-loader",children:e.jsx(W,{color:p?o.yellow:o.purple})}),!E&&r&&r.length===0&&e.jsx("p",{className:"center",children:"Brak danych."}),!E&&r&&r.length>0&&e.jsx("div",{className:"patients-container",children:r.map(t=>{var d;return e.jsxs(ee,{bgColor:p?o.lightPurple:o.lightYellow,className:"patient",onClick:()=>{C(`/patients/${t.patient.id}`)},children:[e.jsxs("dl",{children:[e.jsx("dt",{children:"Numer karty:"}),e.jsx("dd",{style:{color:p?o.yellow:o.purple,fontSize:"1.6rem"},children:t==null?void 0:t.number})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Imię:"}),e.jsx("dd",{children:((d=t.patient)==null?void 0:d.name)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Imię i nazwisko klienta:"}),e.jsx("dd",{children:t.client&&t.client.first_name&&t.client.last_name?t.client.first_name+" "+t.client.last_name:"--"})]})]},t.id)})})]})]})};export{le as default};
