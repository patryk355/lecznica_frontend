import{r as o,A as P,a as ee,u as se,j as e,I as b,f as xe,c as h,B as z,L as U,i as T,Q as v,g as J,h as ae,C as W,k as te,l as re,m as ne,n as de,o as je,e as me,b as R}from"./index-pZH199Q6.js";import{d as _,s as D,p as pe,a as F,n as G,M as $,b as ie,c as le,A as Z,o as oe}from"./validators-sdZyOb8J.js";import{E as O}from"./Appointments-9t7QzL47.js";import{S as Q}from"./Select-n2n9yC1h.js";const ye=({patient:t,client:a})=>{const{darkMode:r}=o.useContext(P),{editPatient:i}=ee(M=>M),{editClient:p,clients:l}=se(M=>M),[s,n]=o.useState(!1),[d,j]=o.useState([]),[w,S]=o.useState(t.birth_date?new Date(t.birth_date):new Date),[u,A]=o.useState(!1),[C,y]=o.useState(null),[c,g]=o.useState(null),[x,f]=o.useState({name:t==null?void 0:t.name,species:(t==null?void 0:t.species)||"",strain:(t==null?void 0:t.strain)||"",coloration:(t==null?void 0:t.coloration)||"",weight:t.weight?parseFloat(t.weight):0,drugs:(t==null?void 0:t.drugs)||"",allergies:(t==null?void 0:t.allergies)||""}),I={first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||"",phone_number:(a==null?void 0:a.phone_number)||"",city:(a==null?void 0:a.city)||"",postcode:(a==null?void 0:a.postcode)||"",street:(a==null?void 0:a.street)||"",street_number:(a==null?void 0:a.street_number)||""},[m,Y]=o.useState(I);o.useEffect(()=>{if(t&&t.clientId&&!l)return;const M=l.map(k=>({value:k.id,label:(k==null?void 0:k.first_name)+" "+(k==null?void 0:k.last_name)}));M.unshift({value:"",label:""}),g(M)},[t,l]);const q=async M=>{if(M.preventDefault(),!s)return;A(!0);const k=[];!D(x.name)&&k.push("name"),!D(x.species)&&k.push("species"),!D(x.strain)&&k.push("strain"),!D(x.coloration)&&k.push("coloration"),x.weight<0&&k.push("weight"),t.clientId&&(!D(m.first_name)&&k.push("first_name"),!D(m.last_name)&&k.push("last_name"),!D(m.city)&&k.push("city"),!D(m.postcode)&&k.push("postcode"),!D(m.street)&&k.push("street"),!D(m.street_number)&&k.push("street_number"),(!m.phone_number||!pe(m.phone_number))&&k.push("phone_number"));const L=_(w).format("YYYY-MM-DD");if(F(L)||k.push("birth_date"),k.length>0){j(k),A(!1);return}j([]);let B=!1,V=!1;if(t.id)try{const H={...x,birth_date:L,weight:parseFloat(x.weight)};!t.clientId&&C&&G(C.value)&&(H.clientId=C.value);const K=await T.put(`/patients/${t.id}`,H);if(i(t.id,K.data),K.data.clientId){const ue=l.find(he=>he.id===K.data.clientId);Y(ue)}console.debug("Details :: submitHandler",K)}catch(H){console.error("Details :: submitHandler",H),V=!0}if(t.clientId&&a.id)try{const H=await T.put(`/clients/${a.id}`,m);p(a.id,H.data),console.debug("Details :: submitHandler",H)}catch(H){console.error("Details :: submitHandler",H),B=!0}B&&v.error("Nie udało się zaktualizować danych klienta"),V&&v.error("Nie udało się zaktualizować danych pacjenta"),!V&&!V?v.success("Dane zostały zaktualizowane"):V&&!B?v.success("Dane klienta zostały zaktualizowane"):!V&&B&&v.success("Dane pacjenta zostały zaktualizowane"),A(!1),n(!1)},E=M=>{const{name:k,value:L}=M.target;f(B=>({...B,[k]:L}))},N=M=>{const{name:k,value:L}=M.target;Y(B=>({...B,[k]:L}))};return e.jsxs("form",{className:"details",children:[e.jsxs("div",{className:"patient",children:[e.jsx("p",{children:"Pacjent"}),s&&e.jsxs("div",{className:"fields",children:[e.jsx(b,{required:!0,id:"name",label:"Imię",value:x.name,onChange:E,hasError:d.includes("name"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"species",label:"Gatunek",value:x.species,onChange:E,hasError:d.includes("species"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"strain",label:"Rasa",value:x.strain,onChange:E,hasError:d.includes("strain"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"coloration",label:"Umaszczenie",value:x.coloration,onChange:E,hasError:d.includes("coloration"),errorText:"Pole wymagane"}),e.jsx(b,{type:"date",required:!0,label:"Data urodzenia",value:w,onChange:M=>S(M),hasError:d.includes("birth_date"),errorText:"Niepoprawna data"}),e.jsx(b,{required:!0,id:"weight",label:"Waga (kg)",type:"number",value:x.weight,onChange:E,hasError:d.includes("weight"),errorText:"Niepoprawna wartość",min:0,step:.5}),e.jsx(b,{type:"textarea",id:"drugs",label:"Leki",value:x.drugs,onChange:E}),e.jsx(b,{type:"textarea",id:"allergies",label:"Alergie",value:x.allergies,onChange:E})]}),!s&&e.jsxs("div",{className:`fields ${r?"dark":"light"}`,children:[e.jsxs("dl",{children:[e.jsx("dt",{children:"Imię"}),e.jsx("dd",{children:(t==null?void 0:t.name)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Gatunek"}),e.jsx("dd",{children:(t==null?void 0:t.species)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Rasa"}),e.jsx("dd",{children:(t==null?void 0:t.strain)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Umaszczenie"}),e.jsx("dd",{children:(t==null?void 0:t.coloration)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Data urodzenia"}),e.jsx("dd",{children:t.birth_date?_(t.birth_date).format("YYYY-MM-DD"):"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Waga"}),e.jsxs("dd",{children:[(t==null?void 0:t.weight)||0," kg"]})]}),e.jsx("dl",{style:{alignItems:"flex-start"},children:e.jsxs("dt",{children:["Leki: ",e.jsx("br",{})," ",e.jsx("br",{}),(t==null?void 0:t.drugs)||"Brak"]})}),e.jsx("dl",{style:{alignItems:"flex-start"},children:e.jsxs("dt",{children:["Alergie: ",e.jsx("br",{})," ",e.jsx("br",{})," ",(t==null?void 0:t.allergies)||"Brak"]})})]})]}),e.jsxs("div",{className:"client",children:[e.jsx("p",{children:"Klient"}),s&&t.clientId&&e.jsxs("div",{className:"fields",children:[e.jsx(b,{required:!0,id:"first_name",name:"first_name",label:"Imię",value:m.first_name,onChange:N,hasError:d.includes("first_name"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"last_name",name:"last_name",label:"Nazwisko",value:m.last_name,onChange:N,hasError:d.includes("last_name"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"city",label:"Miejscowość",value:m.city,onChange:N,hasError:d.includes("city"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"postcode",label:"Kod pocztowy",value:m.postcode,onChange:N,hasError:d.includes("postcode"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"street",label:"Ulica",value:m.street,onChange:N,hasError:d.includes("street"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"street_number",label:"Numer domu",value:m.street_number,onChange:N,hasError:d.includes("street_number"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"phone_number",label:"Numer telefonu",value:m.phone_number,onChange:N,hasError:d.includes("phone_number"),errorText:"Wymagany format: +XXYYYYYYYYY"})]}),s&&!t.clientId&&e.jsxs("div",{className:"no-client-info",children:[e.jsxs("p",{children:[l&&l.length>0?"Wybierz klienta z listy lub utwórz nowego w zakładce ":"Utwórz klienta w zakładce ",e.jsx(xe,{style:{color:r?h.yellow:h.purple},to:"/clients",children:"Klienci"})]}),l&&l.length>0&&e.jsx(Q,{id:"selectedClient",value:C||null,options:c,onChange:M=>{const k=c.find(L=>L.value===parseInt(M.target.selectedOptions[0].value));y(k)}})]}),!s&&!t.clientId&&e.jsx("div",{className:"no-client-info",children:e.jsx("p",{style:{color:h.red},children:"Pacjent nie ma przypisanego klienta (właściciela)"})}),!s&&t.clientId&&e.jsxs("div",{className:`fields ${r?"dark":"light"}`,children:[e.jsxs("dl",{children:[e.jsx("dt",{children:"Imię"}),e.jsx("dd",{children:(a==null?void 0:a.first_name)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Nazwisko"}),e.jsx("dd",{children:(a==null?void 0:a.last_name)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Miejscowość"}),e.jsx("dd",{children:(a==null?void 0:a.city)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Kod pocztowy"}),e.jsx("dd",{children:(a==null?void 0:a.postcode)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Ulica"}),e.jsx("dd",{children:(a==null?void 0:a.street)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Numer domu"}),e.jsx("dd",{children:(a==null?void 0:a.street_number)||"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Telefon"}),e.jsx("dd",{children:(a==null?void 0:a.phone_number)||"--"})]})]})]}),!u&&e.jsxs("div",{className:"edit-btn",children:[!s&&e.jsx(z,{text:"Edytuj",icon:e.jsx(O,{}),onClick:()=>n(!0)}),s&&e.jsxs(e.Fragment,{children:[e.jsx(z,{text:"Anuluj",onClick:()=>n(!1)}),e.jsx(z,{type:"submit",onClick:q,text:"Zatwierdź",textColor:h.white,bgColor:h.green,icon:e.jsx(O,{})})]})]}),u&&e.jsx("div",{style:{margin:"auto",gridColumn:"1 / 3"},children:e.jsx(U,{color:r?h.yellow:h.purple})})]})},X=[{value:"konsultacja",label:"konsultacja"},{value:"szczepienie",label:"szczepienie"},{value:"zabieg",label:"zabieg"}],ce=({patient:t,doctors:a,onClose:r,currentRow:i})=>{const{darkMode:p}=o.useContext(P),l=a.map(m=>({value:m.id,label:(m==null?void 0:m.first_name)+" "+(m==null?void 0:m.last_name)})),{addAppointment:s,editAppointment:n}=J(m=>m),[d,j]=o.useState(i?new Date(i.date):null),[w,S]=o.useState(i?i.notes:""),[u,A]=o.useState(X[0]),[C,y]=o.useState(l[0]),[c,g]=o.useState([]),[x,f]=o.useState(!1);o.useEffect(()=>{if(i){if(i.doctorId){const m=l.find(Y=>Y.value===i.doctorId);m&&y(m)}if(i.type){const m=X.find(Y=>Y.value===i.type);m&&A(m)}}},[i,l]);const I=async m=>{m.preventDefault(),f(!0),g([]);const Y=[],q=_(d).format("YYYY-MM-DD HH:mm:ss");if(ie(q)||Y.push("date"),D(u.value)||Y.push("type"),parseInt(C.value)||Y.push("doctor"),Y.length>0){g(Y),f(!1);return}const E={date:q,type:u.value,notes:w.trim(),doctorId:parseInt(C.value),patientId:t.id};if(i&&i.id){delete E.patientId;try{const N=await T.put(`/appointments/${i.id}`,E);n(i.id,N.data),console.debug("AddAppointment :: submitHandler",N),v.success("Dane wizyty zostały zaktualizowane"),r&&r()}catch(N){console.error("AddAppointment :: submitHandler",N),v.error("Nie udało się zaktualizować danych wizyty")}finally{f(!1)}}else try{const N=await T.post("/appointments",E);console.debug("AddAppointment :: submitHandler",N),v.success("Nowa wizyta została utworzona"),s(N.data),r&&r()}catch(N){console.error("AddAppointment :: submitHandler",N),v.error("Nie udało się dodać nowej wizyty")}finally{f(!1)}};return e.jsx($,{onClose:r,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-appointment",children:[e.jsx("h2",{children:i?"Edytuj wizytę":"Dodaj wizytę"}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{children:[e.jsx(b,{id:"date",type:"datetime",label:"Data",value:d,onChange:m=>j(m),hasError:c.includes("date"),errorText:"Niepoprawna data"}),e.jsx(Q,{id:"type",value:u||null,label:"Rodzaj",options:X,onChange:m=>{const Y=X.find(q=>q.value===m.target.selectedOptions[0].value);A(Y)},hasError:c.includes("type"),errorText:"Pole wymagane"}),l&&e.jsx(Q,{id:"doctor",label:"Lekarz",value:C||null,options:l,onChange:m=>{const Y=l.find(q=>q.value===parseInt(m.target.selectedOptions[0].value));y(Y)},hasError:c.includes("doctor"),errorText:"Pole wymagane"}),e.jsx("div",{}),e.jsx("div",{children:e.jsx(b,{type:"textarea",label:"Uwagi",value:w,onChange:m=>S(m.target.value)})})]}),x?e.jsx("div",{className:"centered-loader",children:e.jsx(U,{color:p?h.yellow:h.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(z,{text:"Anuluj",onClick:r}),e.jsx(z,{text:"Zatwierdź",type:"submit",bgColor:h.green,textColor:h.white})]})]})]})})},ge=({appointment:t,onClose:a,currentRow:r})=>{const{darkMode:i}=o.useContext(P),{addTreatment:p,editTreatment:l}=ae(y=>y),s={type:r?r.type:"",date:r?new Date(r.date):null,notes:r?r.notes:""},[n,d]=o.useState(s),[j,w]=o.useState([]),[S,u]=o.useState(!1),A=async y=>{if(y.preventDefault(),!t.id)return;u(!0);const c=[],g=_(n.date).format("YYYY-MM-DD HH:mm");if(ie(g)||c.push("date"),D(n.type)||c.push("type"),c.length>0){w(c),u(!1);return}w([]);const x={type:n.type.trim(),date:g,appointmentId:t.id};if(n.notes&&le(n.notes)&&(x.notes=n.notes.trim()),r&&r.id){delete x.appointmentId;try{const f=await T.put(`/treatments/${r.id}`,x);l(r.id,f.data),console.debug("AddTreatment :: submitHandler",f),v.success("Dane zabiegu zostały zaktualizowane"),a&&a()}catch(f){console.error("AddTreatment :: submitHandler",f),v.error("Nie udało się zaktualizować danych zabiegu")}finally{u(!1)}}else try{const f=await T.post("/treatments",x);console.debug("AddTreatment :: submitHandler",f),v.success("Dane nowego zabiegu zostały dodane"),p(f.data),a&&a()}catch(f){console.error("AddTreatment :: submitHandler",f),v.error("Nie udało się dodać danych nowego zabiegu")}finally{u(!1)}},C=y=>{const{name:c,value:g}=y.target;d(x=>({...x,[c]:g}))};return e.jsx($,{onClose:a,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-sickness",children:[e.jsx("h2",{children:r?"Edytuj dane zabiegu":"Dodaj dane zabiegu"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{children:[e.jsx(b,{required:!0,label:"Typ",id:"type",value:n.type,onChange:C,hasError:j.includes("type"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"date",type:"datetime",label:"Data",value:n.date,onChange:y=>d(c=>({...c,date:y})),hasError:j.includes("date"),errorText:"Niepoprawna data"}),e.jsx(b,{type:"textarea",label:"Uwagi",id:"notes",value:n.notes,onChange:C})]}),S?e.jsx("div",{className:"centered-loader",children:e.jsx(U,{color:i?h.yellow:h.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(z,{text:"Anuluj",onClick:a}),e.jsx(z,{text:"Zatwierdź",type:"submit",bgColor:h.green,textColor:h.white})]})]})]})})},be=({appointment:t})=>{const a=ae(s=>s.treatments).filter(s=>s.appointmentId===t.id).sort((s,n)=>{const d=_(s.date).unix(),j=_(n.date).unix();return d<j?1:d>j?-1:0}),[r,i]=o.useState(!1),[p,l]=o.useState(null);return e.jsxs(e.Fragment,{children:[r&&e.jsx(ge,{appointment:t,currentRow:p,onClose:()=>{i(!1),l(null)}}),e.jsxs("div",{className:"sicknesses",children:[e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Typ"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Uwagi"}),e.jsx("th",{style:{textAlign:"center"},children:"Edytuj"})]})}),e.jsxs("tbody",{children:[a&&a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:(s==null?void 0:s.type)||"--"}),e.jsx("td",{children:s.date?_(s.date).format("YYYY-MM-DD HH:mm"):"--"}),e.jsx("td",{children:(s==null?void 0:s.notes)||"Brak"}),e.jsx("td",{children:e.jsx("span",{onClick:()=>{i(!0),l(s)},children:e.jsx(O,{})})})]},s.id)),a&&a.length===0&&e.jsx("tr",{className:"no-data",children:e.jsx("td",{colSpan:4,children:"Brak danych."})})]})]}),!a&&e.jsx(W,{})]}),e.jsx("div",{className:"buttons",children:e.jsx(z,{text:"Dodaj",onClick:()=>i(!0),bgColor:h.green,textColor:h.white,icon:e.jsx(Z,{})})})]})]})},fe=({appointment:t,onClose:a,currentRow:r})=>{const{darkMode:i}=o.useContext(P),{addVaccination:p,editVaccination:l}=te(y=>y),s={type:r?r.type:"",serial_number:r?r.serial_number:"",apply_date:r?new Date(r.apply_date):null,expiration_date:r?new Date(r.expiration_date):null,notes:r?r.notes:""},[n,d]=o.useState(s),[j,w]=o.useState([]),[S,u]=o.useState(!1),A=async y=>{if(y.preventDefault(),!t.id)return;u(!0);const c=[],g=_(n.apply_date).format("YYYY-MM-DD"),x=_(n.expiration_date).format("YYYY-MM-DD");if(F(g)||c.push("apply_date"),F(x)||c.push("expiration_date"),D(n.type)||c.push("type"),(!D(n.serial_number)||!oe(n.serial_number))&&c.push("serial_number"),c.length>0){w(c),u(!1);return}if(_(n.apply_date).unix()>_(n.expiration_date).unix()){v.info("Data podania nie może być późniejsza niż data wygaśnięcia"),u(!1);return}w([]);const f={type:n.type.trim(),serial_number:n.serial_number,apply_date:g,expiration_date:x,appointmentId:t.id};if(n.notes&&le(n.notes)&&(f.notes=n.notes.trim()),r&&r.id){delete f.appointmentId;try{const I=await T.put(`/vaccinations/${r.id}`,f);l(r.id,I.data),console.debug("AddVaccination :: submitHandler",I),v.success("Dane szczepionki zostały zaktualizowane"),a&&a()}catch(I){console.error("AddVaccination :: submitHandler",I),v.error("Nie udało się zaktualizować danych szczepionki")}finally{u(!1)}}else try{const I=await T.post("/vaccinations",f);console.debug("AddVaccination :: submitHandler",I),v.success("Dane nowej szczepionki zostały dodane"),p(I.data),a&&a()}catch(I){console.error("AddVaccination :: submitHandler",I),v.error("Nie udało się dodać danych nowej szczepionki")}finally{u(!1)}},C=y=>{const{name:c,value:g}=y.target;d(x=>({...x,[c]:g}))};return e.jsx($,{onClose:a,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-sickness",children:[e.jsx("h2",{children:r?"Edytuj dane szczepionki":"Dodaj dane szczepionki"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{children:[e.jsx(b,{required:!0,label:"Typ",id:"type",value:n.type,onChange:C,hasError:j.includes("type"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,label:"Numer seryjny",id:"serial_number",value:n.serial_number,onChange:C,hasError:j.includes("serial_number"),errorText:"Numer seryjny może się składać tylko z cyfr"}),e.jsx(b,{required:!0,id:"apply_date",type:"date",label:"Data podania",value:n.apply_date,onChange:y=>d(c=>({...c,apply_date:y})),hasError:j.includes("apply_date"),errorText:"Niepoprawna data"}),e.jsx(b,{required:!0,id:"expiration_date",type:"date",label:"Data wygaśnięcia",value:n.expiration_date,onChange:y=>d(c=>({...c,expiration_date:y})),hasError:j.includes("expiration_date"),errorText:"Niepoprawna data"}),e.jsx(b,{type:"textarea",label:"Uwagi",id:"notes",value:n.notes,onChange:C})]}),S?e.jsx("div",{className:"centered-loader",children:e.jsx(U,{color:i?h.yellow:h.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(z,{text:"Anuluj",onClick:a}),e.jsx(z,{text:"Zatwierdź",type:"submit",bgColor:h.green,textColor:h.white})]})]})]})})},ke=({appointment:t})=>{const a=te(s=>s.vaccinations).filter(s=>s.appointmentId===t.id).sort((s,n)=>{const d=_(s.expiration_date).unix(),j=_(n.expiration_date).unix();return d<j?1:d>j?-1:0}),[r,i]=o.useState(!1),[p,l]=o.useState(null);return e.jsxs(e.Fragment,{children:[r&&e.jsx(fe,{appointment:t,currentRow:p,onClose:()=>{i(!1),l(null)}}),e.jsxs("div",{className:"sicknesses",children:[e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Typ"}),e.jsx("th",{children:"Numer seryjny"}),e.jsx("th",{children:"Data podania"}),e.jsx("th",{children:"Data wygaśnięcia"}),e.jsx("th",{children:"Uwagi"}),e.jsx("th",{style:{textAlign:"center"},children:"Edytuj"})]})}),e.jsxs("tbody",{children:[a&&a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:(s==null?void 0:s.type)||"--"}),e.jsx("td",{children:(s==null?void 0:s.serial_number)||"--"}),e.jsx("td",{children:s.apply_date?_(s.apply_date).format("YYYY-MM-DD"):"--"}),e.jsx("td",{children:s.expiration_date?_(s.expiration_date).format("YYYY-MM-DD"):"--"}),e.jsx("td",{children:(s==null?void 0:s.notes)||"Brak"}),e.jsx("td",{children:e.jsx("span",{onClick:()=>{i(!0),l(s)},children:e.jsx(O,{})})})]},s.id)),a&&a.length===0&&e.jsx("tr",{className:"no-data",children:e.jsx("td",{colSpan:6,children:"Brak danych."})})]})]}),!a&&e.jsx(W,{})]}),e.jsx("div",{className:"buttons",children:e.jsx(z,{text:"Dodaj",onClick:()=>i(!0),bgColor:h.green,textColor:h.white,icon:e.jsx(Z,{})})})]})]})},ve=({appointment:t,onClose:a,currentRow:r})=>{const{darkMode:i}=o.useContext(P),{addPrescription:p,editPrescription:l}=re(y=>y),s={number:r?r.number:"",date:r?new Date(r.date):null,drug_name:r?r.drug_name:"",dose:r?r.dose:0,packages_amount:r?r.packages_amount:1},[n,d]=o.useState(s),[j,w]=o.useState([]),[S,u]=o.useState(!1),A=async y=>{if(y.preventDefault(),!t.id)return;u(!0);const c=[],g={number:n.number.trim(),date:_(n.date).format("YYYY-MM-DD"),drug_name:n.drug_name.trim(),dose:parseFloat(n.dose),packages_amount:parseInt(n.packages_amount),appointmentId:t.id};if(F(g.date)||c.push("date"),D(g.drug_name)||c.push("drug_name"),(!D(g.number)||!oe(g.number))&&c.push("number"),(!G(g.dose)||g.dose<=0)&&c.push("dose"),(!G(g.packages_amount)||g.packages_amount<=0)&&c.push("packages_amount"),c.length>0){w(c),u(!1);return}if(w([]),r&&r.id){delete g.appointmentId;try{const x=await T.put(`/prescriptions/${r.id}`,g);l(r.id,x.data),console.debug("AddPrescription :: submitHandler",x),v.success("Dane recepty zostały zaktualizowane"),a&&a()}catch(x){console.error("AddPrescription :: submitHandler",x),v.error("Nie udało się zaktualizować danych recepty")}finally{u(!1)}}else try{const x=await T.post("/prescriptions",g);console.debug("AddPrescription :: submitHandler",x),v.success("Dane recepty zostały dodane"),p(x.data),a&&a()}catch(x){console.error("AddPrescription :: submitHandler",x),v.error("Nie udało się dodać danych recepty")}finally{u(!1)}},C=y=>{const{name:c,value:g}=y.target;d(x=>({...x,[c]:g}))};return e.jsx($,{onClose:a,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-sickness",children:[e.jsx("h2",{children:r?"Edytuj dane recepty":"Dodaj dane recepty"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{children:[e.jsx(b,{required:!0,label:"Numer",id:"number",value:n.number,onChange:C,hasError:j.includes("number"),errorText:"Numer recepty może się składać tylko z cyfr"}),e.jsx(b,{required:!0,id:"date",type:"date",label:"Data",value:n.date,onChange:y=>d(c=>({...c,date:y})),hasError:j.includes("date"),errorText:"Niepoprawna data"}),e.jsx(b,{required:!0,label:"Nazwa leku",id:"drug_name",value:n.drug_name,onChange:C,hasError:j.includes("drug_name"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,label:"Dawka (mg)",type:"number",min:0,step:.05,id:"dose",value:n.dose,onChange:C,hasError:j.includes("dose"),errorText:"Nieprawidłowa wartość"}),e.jsx(b,{required:!0,label:"Ilość",type:"number",min:1,step:1,id:"packages_amount",value:n.packages_amount,onChange:C,hasError:j.includes("packages_amount"),errorText:"Nieprawidłowa ilość"})]}),S?e.jsx("div",{className:"centered-loader",children:e.jsx(U,{color:i?h.yellow:h.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(z,{text:"Anuluj",onClick:a}),e.jsx(z,{text:"Zatwierdź",type:"submit",bgColor:h.green,textColor:h.white})]})]})]})})},we=({appointment:t})=>{const a=re(s=>s.prescriptions).filter(s=>s.appointmentId===t.id).sort((s,n)=>{const d=_(s.date).unix(),j=_(n.date).unix();return d<j?1:d>j?-1:0}),[r,i]=o.useState(!1),[p,l]=o.useState(null);return e.jsxs(e.Fragment,{children:[r&&e.jsx(ve,{appointment:t,currentRow:p,onClose:()=>{i(!1),l(null)}}),e.jsxs("div",{className:"sicknesses",children:[e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Numer"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Nazwa leku"}),e.jsx("th",{children:"Dawka (mg)"}),e.jsx("th",{children:"Ilość"}),e.jsx("th",{style:{textAlign:"center"},children:"Edytuj"})]})}),e.jsxs("tbody",{children:[a&&a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:(s==null?void 0:s.number)||"--"}),e.jsx("td",{children:s.date?_(s.date).format("YYYY-MM-DD"):"--"}),e.jsx("td",{children:(s==null?void 0:s.drug_name)||"--"}),e.jsx("td",{children:(s==null?void 0:s.dose)||"--"}),e.jsx("td",{children:(s==null?void 0:s.packages_amount)||"--"}),e.jsx("td",{children:e.jsx("span",{onClick:()=>{i(!0),l(s)},children:e.jsx(O,{})})})]},s.id)),a&&a.length===0&&e.jsx("tr",{className:"no-data",children:e.jsx("td",{colSpan:6,children:"Brak danych."})})]})]}),!a&&e.jsx(W,{})]}),e.jsx("div",{className:"buttons",children:e.jsx(z,{text:"Dodaj",onClick:()=>i(!0),bgColor:h.green,textColor:h.white,icon:e.jsx(Z,{})})})]})]})},_e=({currentRow:t,patient:a,doctors:r})=>{const{darkMode:i}=o.useContext(P),[p,l]=o.useState(!1),s=J(d=>d.appointments).find(d=>d.id===t.id),n=ne(d=>d.doctors).find(d=>d.id===s.doctorId);return e.jsxs(e.Fragment,{children:[p&&s&&e.jsx(ce,{patient:a,doctors:r,onClose:()=>l(!1),currentRow:s}),e.jsxs("div",{className:"appointment-details",children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:i?h.yellow:h.purple,fontWeight:500},children:(s==null?void 0:s.type)||""}),e.jsx("p",{children:"•"}),e.jsx("p",{children:s.date?_(s.date).format("YYYY-MM-DD HH:mm"):"--"}),e.jsx("p",{children:"•"}),e.jsx("p",{children:n&&n.first_name&&n.last_name?"lek. "+n.first_name+" "+n.last_name:"--"})]}),e.jsx("p",{children:"Uwagi:"}),e.jsx("p",{children:(s==null?void 0:s.notes)||"Brak"}),e.jsx("div",{style:{alignSelf:"center"},children:e.jsx(z,{icon:e.jsx(O,{}),text:"Edytuj",onClick:()=>l(!0)})})]})]})};function Ce(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})})}const ze=({appointment:t,onClose:a,patient:r,doctors:i})=>{const{darkMode:p}=o.useContext(P),[l,s]=o.useState(0);return e.jsxs("div",{className:`appointment-container ${p?"dark":"light"}`,style:{backgroundColor:p?h.lightPurple:h.lightYellow},children:[e.jsxs("ul",{className:"actions",children:[e.jsx("li",{onClick:a,className:"back-icon",title:"Powrót",children:e.jsx(Ce,{})}),e.jsx("li",{className:l===0?"active":"",onClick:()=>s(0),children:"Dane wizyty"}),e.jsx("li",{className:l===1?"active":"",onClick:()=>s(1),children:"Zabiegi"}),e.jsx("li",{className:l===2?"active":"",onClick:()=>s(2),children:"Szczepienia"}),e.jsx("li",{className:l===3?"active":"",onClick:()=>s(3),children:"Recepty"})]}),e.jsxs("div",{className:"content",children:[l===0&&e.jsx(_e,{currentRow:t,patient:r,doctors:i}),l===1&&e.jsx(be,{appointment:t}),l===2&&e.jsx(ke,{appointment:t}),l===3&&e.jsx(we,{appointment:t})]})]})},De=({patient:t})=>{const{appointments:a}=J(d=>d),{doctors:r}=ne(d=>d),i=a.filter(d=>d.patientId===t.id).sort((d,j)=>{const w=_(d.date).unix(),S=_(j.date).unix();return w<S?1:w>S?-1:0}),[p,l]=o.useState(!1),[s,n]=o.useState(null);return e.jsxs(e.Fragment,{children:[p&&e.jsx(ce,{patient:t,doctors:r,currentRow:s,onClose:()=>{l(!1),n(null)}}),!s&&e.jsxs("div",{className:"appointments",children:[e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Rodzaj"}),e.jsx("th",{children:"Lekarz"}),e.jsx("th",{children:"Uwagi"})]})}),e.jsxs("tbody",{children:[i&&r&&i.map(d=>{const j=r.find(w=>w.id===d.doctorId);return e.jsxs("tr",{onClick:()=>n(d),children:[e.jsx("td",{children:d.date?_(d.date).format("YYYY-MM-DD HH:mm"):"--"}),e.jsx("td",{children:(d==null?void 0:d.type)||"--"}),e.jsx("td",{children:j&&j.first_name&&j.last_name?j.first_name+" "+j.last_name:"--"}),e.jsx("td",{style:{overflowX:"hidden"},children:(d==null?void 0:d.notes.slice(0,255))||"Brak"})]},d.id)}),i&&i.length===0&&e.jsx("tr",{className:"no-data",children:e.jsx("td",{colSpan:4,children:"Brak danych."})})]})]}),!i&&e.jsx(W,{})]}),e.jsx("div",{className:"buttons",children:e.jsx(z,{text:"Dodaj",onClick:()=>l(!0),bgColor:h.green,textColor:h.white,icon:e.jsx(Z,{})})})]}),s&&e.jsx(ze,{patient:t,doctors:r,appointment:s,onClose:()=>n(null)})]})},Ne=({patient:t,onClose:a,currentRow:r})=>{const{darkMode:i}=o.useContext(P),{addSickness:p,editSickness:l}=de(y=>y),s={name:r?r.name:"",notes:r?r.notes:"",date:r?new Date(r.date):null},[n,d]=o.useState(s),[j,w]=o.useState([]),[S,u]=o.useState(!1),A=async y=>{if(y.preventDefault(),!t.id)return;u(!0),w([]);const c=[],g=_(n.date).format("YYYY-MM-DD");if(F(g)||c.push("date"),D(n.name)||c.push("name"),D(n.notes)||c.push("notes"),c.length>0){w(c),u(!1);return}const x={name:n.name.trim(),notes:n.notes.trim(),date:g,patientId:t.id};if(r&&r.id){delete x.patientId;try{const f=await T.put(`/sicknesses/${r.id}`,x);l(r.id,f.data),console.debug("AddSickness :: submitHandler",f),v.success("Dane choroby zostały zaktualizowane"),a&&a()}catch(f){console.error("AddSickness :: submitHandler",f),v.error("Nie udało się zaktualizować danych choroby")}finally{u(!1)}}else try{const f=await T.post("/sicknesses",x);console.debug("AddSickness :: submitHandler",f),v.success("Dane nowej choroby została dodana"),p(f.data),a&&a()}catch(f){console.error("AddSickness :: submitHandler",f),v.error("Nie udało się dodać danych nowej choroby")}finally{u(!1)}},C=y=>{const{name:c,value:g}=y.target;d(x=>({...x,[c]:g}))};return e.jsx($,{onClose:a,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-sickness",children:[e.jsx("h2",{children:r?"Edytuj dane choroby":"Dodaj dane wizyty"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{children:[e.jsx(b,{required:!0,label:"Nazwa choroby",id:"name",value:n.name,onChange:C,hasError:j.includes("name"),errorText:"Pole wymagane"}),e.jsx(b,{required:!0,id:"date",type:"date",label:"Data",value:n.date,onChange:y=>d(c=>({...c,date:y})),hasError:j.includes("date"),errorText:"Niepoprawna data"}),e.jsx(b,{required:!0,type:"textarea",label:"Opis",id:"notes",value:n.notes,onChange:C,hasError:j.includes("notes"),errorText:"Pole wymagane"})]}),S?e.jsx("div",{className:"centered-loader",children:e.jsx(U,{color:i?h.yellow:h.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(z,{text:"Anuluj",onClick:a}),e.jsx(z,{text:"Zatwierdź",type:"submit",bgColor:h.green,textColor:h.white})]})]})]})})},Se=({patient:t})=>{const a=de(s=>s.sicknesses).filter(s=>s.patientId===t.id).sort((s,n)=>{const d=_(s.date).unix(),j=_(n.date).unix();return d<j?1:d>j?-1:0}),[r,i]=o.useState(!1),[p,l]=o.useState(null);return e.jsxs(e.Fragment,{children:[r&&e.jsx(Ne,{patient:t,currentRow:p,onClose:()=>{i(!1),l(null)}}),e.jsxs("div",{className:"sicknesses",children:[e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nazwa choroby"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Opis"}),e.jsx("th",{style:{textAlign:"center"},children:"Edytuj"})]})}),e.jsxs("tbody",{children:[a&&a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:(s==null?void 0:s.name)||"--"}),e.jsx("td",{children:s.date?_(s.date).format("YYYY-MM-DD"):"--"}),e.jsx("td",{children:(s==null?void 0:s.notes)||"Brak"}),e.jsx("td",{children:e.jsx("span",{onClick:()=>{i(!0),l(s)},children:e.jsx(O,{})})})]},s.id)),a&&a.length===0&&e.jsx("tr",{className:"no-data",children:e.jsx("td",{colSpan:4,children:"Brak danych."})})]})]}),!a&&e.jsx(W,{})]}),e.jsx("div",{className:"buttons",children:e.jsx(z,{text:"Dodaj",onClick:()=>i(!0),bgColor:h.green,textColor:h.white,icon:e.jsx(Z,{})})})]})]})};function Ye(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}function Me(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25A3.375 3.375 0 0113.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 013.375 3.375M9 15l2.25 2.25L15 12"})})}const He=()=>{const{patientId:t}=je(),{darkMode:a}=o.useContext(P),{user:r}=me(u=>u),i=ee(u=>u.patients).find(u=>u.id===parseInt(t)),p=R(u=>u.charts).find(u=>u.patientId===parseInt(t)),{editChart:l}=R(u=>u),s=se(u=>u.clients).find(u=>u.id===i.clientId),[n,d]=o.useState(0),[j,w]=o.useState(!1),S=async()=>{if(p.id)try{const u=await T.put(`/charts/${p.id}`,{is_active:!p.is_active});console.debug("Patient :: updateChart",u),l(p.id,u.data),v.success(p.is_active?"Karta pacjenta została zarchiwizowana":"Karta pacjenta została aktywowana")}catch(u){console.error("Patient :: updateChart",u),v.error(p.is_active?"Nie udało się zarchiwizować karty pacjenta":"Nie udało się aktywować karty pacjenta")}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[j&&e.jsx($,{onClose:()=>w(!1),width:300,children:e.jsxs("div",{className:"archive-chart-modal",children:[e.jsx("h2",{children:p.is_active?"Potwierdź archiwizację":"Potwierdź aktywację"}),e.jsxs("div",{children:[e.jsx(z,{text:"Anuluj",onClick:()=>w(!1)}),e.jsx(z,{text:"Potwierdź",onClick:S,textColor:h.white,bgColor:p.is_active?h.red:h.green})]})]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem",justifyContent:"space-between"},children:[e.jsxs("h2",{style:{textAlign:"center"},children:["Numer karty pacjenta: ",p==null?void 0:p.number]}),r.is_admin&&e.jsx(z,{onClick:()=>w(!0),text:p.is_active?"Archiwizuj":"Aktywuj",textColor:h.white,bgColor:p.is_active?h.red:h.green,icon:p.is_active?e.jsx(Ye,{}):e.jsx(Me,{})})]}),e.jsxs("div",{className:`patient-container ${a?"dark":"light"}`,style:{backgroundColor:a?h.lightPurple:h.lightYellow},children:[e.jsxs("ul",{className:"actions",children:[e.jsx("li",{className:n===0?"active":"",onClick:()=>d(0),children:"Dane"}),e.jsx("li",{className:n===1?"active":"",onClick:()=>d(1),children:"Historia wizyt"}),e.jsx("li",{className:n===2?"active":"",onClick:()=>d(2),children:"Historia chorób"})]}),e.jsxs("div",{className:`${n===1?"":"content"}`,children:[n===0&&e.jsx(ye,{patient:i,client:s}),n===1&&e.jsx(De,{patient:i}),n===2&&e.jsx(Se,{patient:i})]})]})]})};export{He as default};
