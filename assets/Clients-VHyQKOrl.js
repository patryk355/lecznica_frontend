import{j as e,u as N,a as M,r as i,L as S,B as C,c as a,i as L,Q as v,A as E,I as p,e as D}from"./index-pZH199Q6.js";import{C as I}from"./Card-UHU3zEgu.js";import{M as A,s as y,p as P,A as $}from"./validators-sdZyOb8J.js";import{E as H}from"./Appointments-9t7QzL47.js";function T(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})})}function B(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}const U=({onClose:t,clientId:l})=>{const{removeClient:x}=N(o=>o),{patients:f,editPatient:_}=M(o=>o),[n,r]=i.useState(!1),m=()=>{l&&(r(!0),L.delete(`/clients/${l}`).then(()=>{x(l);const o=f.find(c=>c.clientId===l);_(o.id,{clientId:null}),v.success("Klient został usunięty"),t()}).catch(o=>{v.error("Klient nie został usunięty"),console.error("DeleteClient: ",o)}).finally(()=>{r(!1)}))};return e.jsx(A,{onClose:t,width:350,children:e.jsxs("div",{className:"delete-client-modal",children:[e.jsx("h2",{children:"Czy na pewno chcesz usunąć klienta?"}),e.jsxs("div",{children:[n&&e.jsx(S,{}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(C,{text:"Anuluj",onClick:t}),e.jsx(C,{text:"Potwierdź",onClick:m,textColor:a.white,bgColor:a.red})]})]})]})})},z=({client:t,onClose:l})=>{const{darkMode:x}=i.useContext(E),{addClient:f,editClient:_}=N(j=>j),n={first_name:t?t.first_name:"",last_name:t?t.last_name:"",phone_number:t?t.phone_number:"",city:t?t.city:"",postcode:t?t.postcode:"",street:t?t.street:"",street_number:t?t.street_number:""},[r,m]=i.useState(n),[o,c]=i.useState([]),[g,b]=i.useState(!1),k=async j=>{j.preventDefault(),b(!0),c([]);const u={first_name:r.first_name.trim(),last_name:r.last_name.trim(),city:r.city.trim(),postcode:r.postcode.trim(),street:r.street.trim(),street_number:r.street_number.trim(),phone_number:r.phone_number.trim()},d=[];if(y(u.first_name)||d.push("first_name"),y(u.last_name)||d.push("last_name"),y(u.city)||d.push("city"),y(u.postcode)||d.push("postcode"),y(u.street)||d.push("street"),y(u.street_number)||d.push("street_number"),P(u.phone_number)||d.push("phone_number"),d.length>0){c(d),b(!1);return}if(t&&t.id)try{const s=await L.put(`/clients/${t.id}`,u);_(t.id,s.data),console.debug("AddClient :: submitHandler",s),v.success("Dane klienta zostały zaktualizowane"),l&&l()}catch(s){console.error("AddClient :: submitHandler",s),v.error("Nie udało się zaktualizować danych klienta")}finally{b(!1)}else try{const s=await L.post("/clients",u);console.debug("AddClient :: submitHandler",s),v.success("Nowy klient został utworzony"),f(s.data),l&&l()}catch(s){console.error("AddClient :: submitHandler",s),v.error("Nie udało się dodać nowego klienta")}finally{b(!1)}},h=j=>{const{name:u,value:d}=j.target;m(s=>({...s,[u]:d}))};return e.jsx(A,{onClose:l,width:500,disableOverlayOnClose:!0,children:e.jsxs("div",{className:"add-appointment",children:[e.jsx("h2",{children:t?"Edytuj klienta":"Dodaj klienta"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{children:[e.jsx(p,{id:"first_name",label:"Imię",value:r.first_name,onChange:h,hasError:o.includes("first_name"),errorText:"Pole wymagane"}),e.jsx(p,{id:"last_name",label:"Nazwisko",value:r.last_name,onChange:h,hasError:o.includes("last_name"),errorText:"Pole wymagane"}),e.jsx(p,{id:"city",label:"Miejscowość",value:r.city,onChange:h,hasError:o.includes("city"),errorText:"Pole wymagane"}),e.jsx(p,{id:"postcode",label:"Kod pocztowy",value:r.postcode,onChange:h,hasError:o.includes("postcode"),errorText:"Pole wymagane"}),e.jsx(p,{id:"street",label:"Ulica",value:r.street,onChange:h,hasError:o.includes("street"),errorText:"Pole wymagane"}),e.jsx(p,{id:"street_number",label:"Numer domu",value:r.street_number,onChange:h,hasError:o.includes("street_number"),errorText:"Pole wymagane"}),e.jsx(p,{id:"phone_number",label:"Numer telefonu",value:r.phone_number,onChange:h,hasError:o.includes("phone_number"),errorText:"Nieprawidłowy numer telefonu"})]}),g?e.jsx("div",{className:"centered-loader",children:e.jsx(S,{color:x?a.yellow:a.purple})}):e.jsxs("div",{className:"buttons",children:[e.jsx(C,{text:"Anuluj",onClick:l}),e.jsx(C,{text:"Zatwierdź",type:"submit",bgColor:a.green,textColor:a.white})]})]})]})})},F=()=>{const{darkMode:t}=i.useContext(E),{user:l}=D(s=>s),{clients:x}=N(s=>s),[f,_]=i.useState(!1),[n,r]=i.useState(""),[m,o]=i.useState([]),[c,g]=i.useState(null),[b,k]=i.useState(!1),[h,j]=i.useState(!1),[u,d]=i.useState(!1);return i.useEffect(()=>{if(!x)return;_(!0);let s=[];n?s=x.filter(w=>w.first_name.toLowerCase().includes(n.toLowerCase())||w.last_name.toLowerCase().includes(n.toLowerCase())||w.phone_number.toLowerCase().includes(n.toLowerCase())||w.city.toLowerCase().includes(n.toLowerCase())||w.postcode.toLowerCase().includes(n.toLowerCase())||w.street.toLowerCase().includes(n.toLowerCase())||w.street_number.toLowerCase().includes(n.toLowerCase())):s=x,o(s),_(!1)},[n,x]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"clients",children:[e.jsxs("div",{className:"actions",children:[e.jsx(p,{placeholder:"Wyszukaj klienta...",inputWidth:"30rem",value:n,onChange:s=>r(s.target.value)}),l.is_admin&&e.jsx(C,{text:"Dodaj klienta",color:t?"light":"dark",icon:e.jsx($,{}),bgColor:a.green,textColor:a.white,onClick:()=>k(!0)})]}),f&&e.jsx("div",{className:"centered-loader",children:e.jsx(S,{color:t?a.yellow:a.purple})}),!f&&m&&m.length===0&&e.jsx("p",{className:"center",children:"Brak danych."}),!f&&m&&m.length>0&&e.jsx("div",{className:"clients-container",children:m.map(s=>e.jsxs(I,{bgColor:t?a.lightPurple:a.lightYellow,className:"client",children:[e.jsxs("div",{className:"content",children:[e.jsx("span",{children:e.jsx(T,{})}),e.jsxs("div",{className:"client-data",children:[e.jsxs("dl",{children:[e.jsx("dt",{children:"Imię i nazwisko:"}),e.jsx("dd",{style:{color:t?a.yellow:a.purple,fontSize:"1.6rem"},children:`${(s==null?void 0:s.first_name)||""} ${(s==null?void 0:s.last_name)||""}`})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Numer telefonu:"}),e.jsx("dd",{children:s.phone_number?e.jsx("a",{href:`tel:${s.phone_number}`,children:s.phone_number}):"--"})]}),e.jsxs("dl",{children:[e.jsx("dt",{children:"Adres:"}),e.jsx("dd",{children:`${(s==null?void 0:s.city)||""} ${(s==null?void 0:s.postcode)||""}, ${(s==null?void 0:s.street)||""} ${(s==null?void 0:s.street_number)||""}`})]})]})]}),e.jsxs("div",{className:"actions",children:[e.jsx(C,{onClick:()=>{j(!0),g(s)},bgColor:t?a.yellow:a.white,text:"Edytuj",icon:e.jsx(H,{})}),l.is_admin&&e.jsx(C,{onClick:()=>{d(!0),g(s)},bgColor:a.red,textColor:a.white,text:"Usuń",icon:e.jsx(B,{})})]})]},s.id))})]}),u&&c!==null&&e.jsx(U,{clientId:c.id,onClose:()=>{g(null),d(!1)}}),b&&c===null&&e.jsx(z,{onClose:()=>k(!1)}),h&&c!==null&&e.jsx(z,{onClose:()=>{g(null),j(!1)},client:c})]})};export{F as default};
